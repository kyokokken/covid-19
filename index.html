<html>
<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.8.1/css/bulma.min.css" />
	<style>
		.w50 {width: 50%}
		.w90 {width: 90%}
		.h50 {height: 50%}
	
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
	
	</style>
</head>
<body>
	<div>
			<canvas  id="myChart" style="display: block; width: 1000px; height: 500px;"  width="1000" height="500"></canvas>
	</div>
	
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
	<!-- script for add jQuery -->
	<script
	src="https://code.jquery.com/jquery-3.4.1.min.js"
	integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
	crossorigin="anonymous">
</script>
<script>
	let data_rilievo = [];
	let ricoverati_con_sintomi = [];
	let terapia_intensiva = [];
	let isolamento_domiciliare = [];
	let totale_positivi = [];
	let variazione_totale_positivi = [];
	let nuovi_positivi = [];
	let dimessi_guariti = [];
	let deceduti = [];
	let totale_casi = [];
	
	$(document).ready(() => {
		
		$.getJSON("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-json/dpc-covid19-ita-andamento-nazionale.json", data => {
			$.each(data, (i, el) => {
				data_rilievo.push(el.data);
				ricoverati_con_sintomi.push(el.ricoverati_con_sintomi);
				terapia_intensiva.push(el.terapia_intensiva);
				isolamento_domiciliare.push(el.isolamento_domiciliare);
				totale_positivi.push(el.totale_positivi);
				variazione_totale_positivi.push(el.variazione_totale_positivi);
				nuovi_positivi.push(el.nuovi_positivi);
				dimessi_guariti.push(el.nuovi_positivi);
				deceduti.push(el.deceduti);
				totale_casi.push(el.totale_casi);
			});
			loadCompleted();
		});
	});
	
	function loadCompleted() {
		console.log(data_rilievo);
		// Semplifica le date
		data_rilievo = data_rilievo.map(el => {return toSimpleDate(el);});
		
		loadChart();
	}
	
	// Converts dates from 2020-02-24T18:00:00 to 24-02
	function toSimpleDate(date) {
		parsedDate = date.match(/\d{4}-(\d{2})-(\d{2})T\d{2}:\d{2}:\d{2}/);
		return parsedDate[2] + "-" + parsedDate[1];
	}
	
	
	function loadChart() {
		var ctx = document.getElementById('myChart').getContext('2d');
		window.myChartConfig = {
			type: 'line',
			data: {
				labels: data_rilievo,
				datasets: [
				{
					label: 'ricoverati con sintomi',
					data: ricoverati_con_sintomi,
					backgroundColor: [
					'rgba(194, 194, 76, 0.2)'
					],
					borderColor: [
					'rgba(194, 194, 76, 1)'
					],
					//borderWidth: 1
				},
				{
					label: 'terapia intensiva',
					data: terapia_intensiva,
					backgroundColor: [
					'rgba(194, 132, 132, 0.2)'
					],
					borderColor: [
					'rgba(194, 132, 132, 1)'
					],
					borderWidth: 1
				},
				{
					label: 'isolamento domiciliare',
					data: isolamento_domiciliare,
					backgroundColor: [
					'rgba(75, 99, 199, 0.2)'
					],
					borderColor: [
					'rgba(75, 99, 199, 1)'
					],
					borderWidth: 1
				},
				{
					label: 'totale positivi',
					data: totale_positivi,
					backgroundColor: [
					'rgba(145, 99, 132, 0.2)'
					],
					borderColor: [
					'rgba(145, 99, 132, 1)'
					],
					borderWidth: 1
				},
				{
					label: 'variazione_totale_positivi',
					data: variazione_totale_positivi,
					backgroundColor: [
					'rgba(145, 99, 132, 0.2)'
					],
					borderColor: [
					'rgba(145, 99, 132, 1)'
					],
					borderWidth: 1
				},
				{
					label: 'nuovi positivi',
					data: nuovi_positivi,
					backgroundColor: [
					'rgba(145, 99, 132, 0.2)'
					],
					borderColor: [
					'rgba(145, 99, 132, 1)'
					],
					borderWidth: 1
				},
				{
					label: 'dimessi guariti',
					data: dimessi_guariti,
					backgroundColor: [
					'rgba(45, 190, 75, 0.2)'
					],
					borderColor: [
					'rgba(45, 190, 75, 1)'
					],
					borderWidth: 1
				},
				{
					label: 'deceduti',
					data: deceduti,
					backgroundColor: [
					'rgba(255, 99, 132, 0.2)'
					],
					borderColor: [
					'rgba(255, 99, 132, 1)'
					],
					borderWidth: 1
				},
				{
					label: 'totale casi',
					data: totale_casi,
					backgroundColor: [
					'rgba(145, 145, 132, 0.2)'
					],
					borderColor: [
					'rgba(145, 145, 132, 1)'
					],
					borderWidth: 1
				}]
			},
			options: {
				scales: {
					yAxes: [{
						ticks: {
							beginAtZero: true
						}
					}]
				},
				legend: {
					display: true
				}
			}
		}
		window.myChart = new Chart(ctx, window.myChartConfig);
	}
</script>

<script>
	$('#addGiorno').on('click', () => {
		window.myChartConfig.data.labels.push('new');
		window.myChartConfig.data.datasets.forEach(dataset => {
			dataset.data.push(1000);
		});
		window.myChart.update();
	});
</script>


<!-- <script>
	var settings = {
		"async": true,
		"crossDomain": true,
		"url": "https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-json/dpc-covid19-ita-province-latest.json",
		"method": "GET"
	}
	
	$.ajax(settings).done(function (response) {
		console.log(response);
	});
</script> -->
</body>
</html>